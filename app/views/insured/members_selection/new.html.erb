<% content_for :horizontal_status do %>
  <%= render :partial => 'insured/families/horizontal_status.html.erb', locals: {step: 1} %>
<% end %>
<% effective_date_for_display = @effective_on_date || @new_effective_on %>
<div class="container group-selection">
  <div class="row">
    <%= form_tag(:insured_group_selections, :id => "group-selection-form") do %>
      <div class="col-xs-8">
        <h1 class="darkblue"><%= l10n("insured.group_selection.new.choose_coverage_for_your_household") %></h1>
        <p class="twenty">Select who needs coverage and the type of coverage needed. When youâ€™re finished, select CONTINUE.</p>
        <div style="font-size :24px">
        <%if @effective_on_date.present? || @new_effective_on%>
          <%= l10n("insured.group_selection.new.effective_date") %>: <span style="color: red;"><%= format_date(effective_date_for_display) %></span>
        <%end%>
        </div>
       <% if @can_shop_shop %>
          <%= render partial: 'select_employer', locals: {effective_date: effective_date_for_display} %>
        <% end %>

        <h3><%= l10n("insured.group_selection.new.who_needs_coverage") %></h3>
        <%= hidden_field_tag(:waiver_reason, nil, id: "waiver_reason_hidden_value_field") %>
        <%= hidden_field_tag(:is_waiving, nil, id: "is_waiving_hidden_value_field") %>
        <%= hidden_field_tag(:person_id, @person.id) %>
        <%= hidden_field_tag(:coverage_household_id, @coverage_household_id) %>
        <%= hidden_field_tag(:enrollment_kind, @enrollment_kind) %>
        <%= hidden_field_tag(:hbx_enrollment_id, @hbx_enrollment.id) if @hbx_enrollment.present? %>
        <%= hidden_field_tag(:shop_under_current, @shop_under_current) if @shop_under_current %>
        <%= hidden_field_tag(:shop_under_future, @shop_under_future) if @shop_under_future %>

          <% if @can_shop_shop || @can_shop_individual || @can_shop_resident %>
            <div id="coverage-household" class='row no-buffer'>
              <div class="module group-selection-table">
                <div class="table-responsive table-border" style="background-color: #fff">
                  <% @show_residency_alert = false %>
                  <%= render 'coverage_household' %>
                </div>
              </div>
            </div>
          <% end %>

          <% if @can_shop_both_markets %>
            <div id="market_kinds" class='row no-buffer'>
                <h3><%= l10n("insured.group_selection.new.marketplace") %></h3>
              <span class="clear" style="display: il"></span>

              <div class="n-radio-group">
                <% Plan::MARKET_KINDS.each_with_index do |kind, index| %>
                  <div class="n-radio-row">
                    <label class="n-radio" for="market_kind_<%= kind %>">
                      <%= radio_button_tag 'market_kind', kind, index == 0, id: "market_kind_#{kind}", required: true, class: "n-radio", checked: is_market_kind_checked?(kind), disabled: is_market_kind_disabled?(kind) %>
                      <span class="n-radio">
                      </span>
                      <% if kind=="shop" %>
                        <%= l10n("insured.group_selection.new.employee_sponsored_benifits") %>
                      <% else %>
                        <%= l10n("insured.group_selection.new.individual_benifits") %>
                      <% end %>
                    </label>
                  </div>
                <% end %>
              </div>
            </div>
          <% elsif @can_shop_shop %>
             <%= hidden_field_tag 'market_kind', 'shop' %>
          <% else %>
            <% if @market_kind.present? %>
              <%= hidden_field_tag 'market_kind', @market_kind %>
            <% end %>
          <% end %>



          <% if @change_plan.present? %>
            <%= hidden_field_tag 'change_plan', @change_plan %>
            <%= hidden_field_tag 'effective_on_option_selected', params[:effective_on_option_selected] if params[:effective_on_option_selected].present?%>
            <br/>
            <h3><%= l10n("insured.group_selection.new.what_would_you_like_to_do") %></h3>
              <%= submit_tag l10n('shop_for_new_plan'), class: 'btn btn-primary  btn-lg'+ pundit_class(Family, :updateable?) %>
            <% if @hbx_enrollment.present? && @hbx_enrollment.may_terminate_coverage? %>
              <%= submit_tag l10n('keep_existing_plan'), class: 'btn btn-primary  btn-lg' + pundit_class(Family, :updateable?) if show_keep_existing_plan(@shop_for_plans, @hbx_enrollment, @new_effective_on) %>
	      <%= link_to l10n('select_plan_to_terminate'), '#', data: {toggle: "modal", target: "#waive_confirm"}, class: 'btn btn-primary btn-lg' %>

            <% end %>
          <% end %>
          <br/>
        <br/>
          <%= link_to l10n("back_to_my_account"), family_account_path, class: 'btn btn-default btn btn-lg' %>
        </div>
      <div class="col-xs-3 right-section pull-right">
          <% if @change_plan.blank? %>
            <%= render  partial: 'shared/signup_progress', locals: {step: '4'} %>
          <% elsif @change_plan == "change_by_qle" %>
            <%= render partial: 'shared/qle_progress', locals: {step: '2',show_button:false} %>
          <% elsif @change_plan == "change_plan" %>
              <%= render partial: 'shared/shop_for_plans_progress', locals: {step: '1', show_waive: true} %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
  <%= render :partial => "ui-components/v1/modals/waive_confirmation", :locals => {:enrollment => @hbx_enrollment } if (@hbx_enrollment.present? && (@hbx_enrollment.employee_role.present? || @hbx_enrollment.benefit_group.present?)) %>
</div>
