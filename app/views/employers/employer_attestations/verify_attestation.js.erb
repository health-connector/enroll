$('.attestation_form').html("<%= escape_javascript(render "verify_attestation") %>");
$('.attestation_form').show();
$('#reviewClose').click(function() {
    $('.attestation_form').hide();
    event.preventDefault();
    $('tr.child-row:visible').remove();
    $('#attestation_documents_table').hide();
});

$("input[name='status']").click(function(){
    $("input[name='other_reason']").addClass('hidden');
    if ($(this).val() === 'rejected' || $(this).val() === 'info_needed') {
        $('.rejection_reason').removeClass('hidden');
        if ($(this).val() === 'rejected')
        {
          reason_for_reject = true
          $('#reason_for_reject').removeClass('hidden');
          $('#reason_for_extra_info').addClass('hidden');
          if ($('select#reason_for_rejection').val() == "")
            $('#attestation_submit').addClass('disabled');
          rejectReason('select#reason_for_rejection')
        }
        else if ($(this).val() === 'info_needed')
        {
          reason_for_reject = false
          $('#reason_for_reject').addClass('hidden');
          $('#reason_for_extra_info').removeClass('hidden');
          if ($('select#reason_for_info_needed').val() == "")
            $('#attestation_submit').addClass('disabled');
          rejectReason('select#reason_for_info_needed')
        }
    }
    else {
        $('.rejection_reason').addClass('hidden');
        $("input[name='other_reason']").addClass('hidden');
         $('#attestation_submit').removeClass('disabled');
    }
});

function rejectReason(name) {
    var x = $(name).val();
    if (x == "Other Reason") {
        $("input[name='other_reason']").removeClass('hidden');
        $('#attestation_submit').addClass('disabled');
    } else if (x == "") {
        $("input[name='other_reason']").addClass('hidden');
        $('#attestation_submit').addClass('disabled');
    } else {
        $("input[name='other_reason']").addClass('hidden');
        $('#attestation_submit').removeClass('disabled');
    }
}

$("input[name='other_reason']").on('change keydown paste input', function(){
    if ($("input[name='other_reason']").val() == '') {
        $('#attestation_submit').addClass('disabled');
    }
    else {
        $('#attestation_submit').removeClass('disabled');
    }
});

$('select#reason_for_rejection').on('selectric-init', function(event, element, selectric) {
   $('.employer_attestation_fields .selectric-wrapper').css({'width': '315px'});
   $("input[name='other_reason']").css({'margin-top': '8px'})
});

$('select#reason_for_info_needed').on('selectric-init', function(event, element, selectric) {
   $('.employer_attestation_fields .selectric-wrapper').css({'width': '315px'});
   $("input[name='other_reason']").css({'margin-top': '8px'})
});

$('#attestation_submit').click(function() {
    var confirmation = confirm('Are You Sure? Changing Employer Attestation Documentation status from '+ $("input[name='prev_status']").val() + ' to ' + $("input[name='status']:checked").val());
    if (confirmation != true) {
      return false;
    }
})
