<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: ConvergeDataExport
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "ConvergeDataExport";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (C)</a> &raquo;
    
    
    <span class="title">ConvergeDataExport</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: ConvergeDataExport
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ConvergeDataExport</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/converge_data_export.rb</dd>
  </dl>
  
</div>


  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="XML_FOLDER_PATH-constant" class="">XML_FOLDER_PATH =
        
      </dt>
      <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='embexpr_end'>}</span><span class='tstring_content'>/LatestXmlFiles/ivl_final/</span><span class='tstring_end'>&quot;</span></span></pre></dd>
    
  </dl>







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#belongs_to_current_year%3F-instance_method" title="#belongs_to_current_year? (instance method)">#<strong>belongs_to_current_year?</strong>(enrollment)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#export_active_ea_missing_termed_in_edi-instance_method" title="#export_active_ea_missing_termed_in_edi (instance method)">#<strong>export_active_ea_missing_termed_in_edi</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#export_ea_missing_enrollments-instance_method" title="#export_ea_missing_enrollments (instance method)">#<strong>export_ea_missing_enrollments</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#export_renewal_missing_enrollments-instance_method" title="#export_renewal_missing_enrollments (instance method)">#<strong>export_renewal_missing_enrollments</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#find_family_by_subscriber-instance_method" title="#find_family_by_subscriber (instance method)">#<strong>find_family_by_subscriber</strong>(enrollment)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#headers-instance_method" title="#headers (instance method)">#<strong>headers</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>  &#x21d2; ConvergeDataExport </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of ConvergeDataExport.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="ConvergeDataExport (class)">ConvergeDataExport</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of ConvergeDataExport</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


5
6</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/converge_data_export.rb', line 5</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="belongs_to_current_year?-instance_method">
  
    #<strong>belongs_to_current_year?</strong>(enrollment)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/converge_data_export.rb', line 88</span>

<span class='kw'>def</span> <span class='id identifier rubyid_belongs_to_current_year?'>belongs_to_current_year?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="TimeKeeper.html" title="TimeKeeper (class)">TimeKeeper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_date_of_record'><span class='object_link'><a href="TimeKeeper.html#date_of_record-class_method" title="TimeKeeper.date_of_record (method)">date_of_record</a></span></span><span class='period'>.</span><span class='id identifier rubyid_beginning_of_year'>beginning_of_year</span><span class='op'>..</span><span class='const'>TimeKeeper</span><span class='period'>.</span><span class='id identifier rubyid_date_of_record'>date_of_record</span><span class='period'>.</span><span class='id identifier rubyid_end_of_year'>end_of_year</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_cover?'>cover?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_effective_on'>effective_on</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="export_active_ea_missing_termed_in_edi-instance_method">
  
    #<strong>export_active_ea_missing_termed_in_edi</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/converge_data_export.rb', line 92</span>

<span class='kw'>def</span> <span class='id identifier rubyid_export_active_ea_missing_termed_in_edi'>export_active_ea_missing_termed_in_edi</span>

  <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_counter'>counter</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>active_ea_and_no_edi_coverage_exceptions.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>w</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_csv'>csv</span><span class='op'>|</span>

    <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_headers'>headers</span>
    <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_glob'>glob</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='embexpr_end'>}</span><span class='tstring_content'>/LatestXmlFiles/ivl_final/*.xml</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file_path'>file_path</span><span class='op'>|</span>
        <span class='id identifier rubyid_individual_parser'>individual_parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Parsers.html" title="Parsers (module)">Parsers</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml.html" title="Parsers::Xml (module)">Xml</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml/Cv.html" title="Parsers::Xml::Cv (module)">Cv</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml/Cv/Importers.html" title="Parsers::Xml::Cv::Importers (module)">Importers</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml/Cv/Importers/EnrollmentParser.html" title="Parsers::Xml::Cv::Importers::EnrollmentParser (class)">EnrollmentParser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Parsers/Xml/Cv/Importers/EnrollmentParser.html#initialize-instance_method" title="Parsers::Xml::Cv::Importers::EnrollmentParser#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_file_path'>file_path</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_enrollment'>enrollment</span> <span class='op'>=</span> <span class='id identifier rubyid_individual_parser'>individual_parser</span><span class='period'>.</span><span class='id identifier rubyid_get_enrollment_object'>get_enrollment_object</span>
      <span class='kw'>begin</span>

        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_belongs_to_current_year?'>belongs_to_current_year?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_canceled'>canceled</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_coverage_end_on'>coverage_end_on</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_coverage_start_on'>coverage_start_on</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_coverage_end_on'>coverage_end_on</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_canceled'>canceled</span> <span class='op'>=</span> <span class='kw'>true</span> 
        <span class='kw'>end</span>

        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_canceled'>canceled</span> <span class='op'>||</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_terminated_on'>terminated_on</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_counter'>counter</span> <span class='op'>+=</span> <span class='int'>1</span>

        <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='period'>.</span><span class='id identifier rubyid_by_hbx_id'><span class='object_link'><a href="HbxEnrollment.html#by_hbx_id-class_method" title="HbxEnrollment.by_hbx_id (method)">by_hbx_id</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_match'>match</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
          <span class='id identifier rubyid_family'>family</span> <span class='op'>=</span> <span class='id identifier rubyid_find_family_by_subscriber'>find_family_by_subscriber</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_family'>family</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='period'>.</span><span class='id identifier rubyid_family'>family</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_matched_enrollments'>matched_enrollments</span> <span class='op'>=</span> <span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_active_household'>active_household</span><span class='period'>.</span><span class='id identifier rubyid_hbx_enrollments'>hbx_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span>
          <span class='symbol'>:kind</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span>
          <span class='symbol'>:aasm_state</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HbxEnrollment.html#ENROLLED_STATUSES-constant" title="HbxEnrollment::ENROLLED_STATUSES (constant)">ENROLLED_STATUSES</a></span></span><span class='rparen'>)</span><span class='comma'>,</span>
          <span class='symbol'>:coverage_kind</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_coverage_kind'>coverage_kind</span>
          <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order_by'>order_by</span><span class='lparen'>(</span><span class='symbol'>:effective_on</span><span class='period'>.</span><span class='id identifier rubyid_asc'>asc</span><span class='rparen'>)</span>
        <span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_active_year'>active_year</span> <span class='op'>==</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_active_year'>active_year</span><span class='rbrace'>}</span>
        <span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_en'>en</span><span class='op'>|</span> <span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span> <span class='op'>!=</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='rparen'>)</span><span class='rbrace'>}</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_matched_enrollments'>matched_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
          <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_counter'>counter</span> <span class='op'>%</span> <span class='int'>100</span> <span class='op'>==</span> <span class='int'>0</span>
          <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Processed </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_counter'>counter</span><span class='embexpr_end'>}</span><span class='tstring_content'> Missing -- </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
        <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_to_csv'>to_csv</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="export_ea_missing_enrollments-instance_method">
  
    #<strong>export_ea_missing_enrollments</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/converge_data_export.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_export_ea_missing_enrollments'>export_ea_missing_enrollments</span>
  <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_counter'>counter</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>enrollments_edi_active_missing_in_EA.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>w</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_csv'>csv</span><span class='op'>|</span>

    <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_headers'>headers</span>
    <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_glob'>glob</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='embexpr_end'>}</span><span class='tstring_content'>/LatestXmlFiles/ivl_final/*.xml</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file_path'>file_path</span><span class='op'>|</span>
        <span class='id identifier rubyid_individual_parser'>individual_parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Parsers.html" title="Parsers (module)">Parsers</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml.html" title="Parsers::Xml (module)">Xml</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml/Cv.html" title="Parsers::Xml::Cv (module)">Cv</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml/Cv/Importers.html" title="Parsers::Xml::Cv::Importers (module)">Importers</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml/Cv/Importers/EnrollmentParser.html" title="Parsers::Xml::Cv::Importers::EnrollmentParser (class)">EnrollmentParser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Parsers/Xml/Cv/Importers/EnrollmentParser.html#initialize-instance_method" title="Parsers::Xml::Cv::Importers::EnrollmentParser#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_file_path'>file_path</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_enrollment'>enrollment</span> <span class='op'>=</span> <span class='id identifier rubyid_individual_parser'>individual_parser</span><span class='period'>.</span><span class='id identifier rubyid_get_enrollment_object'>get_enrollment_object</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_counter'>counter</span> <span class='op'>+=</span> <span class='int'>1</span>

        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_belongs_to_current_year?'>belongs_to_current_year?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_canceled'>canceled</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_coverage_end_on'>coverage_end_on</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_coverage_start_on'>coverage_start_on</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_coverage_end_on'>coverage_end_on</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_canceled'>canceled</span> <span class='op'>=</span> <span class='kw'>true</span> 
        <span class='kw'>end</span>

        <span class='kw'>next</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_canceled'>canceled</span> <span class='op'>||</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_terminated_on'>terminated_on</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='period'>.</span><span class='id identifier rubyid_by_hbx_id'><span class='object_link'><a href="HbxEnrollment.html#by_hbx_id-class_method" title="HbxEnrollment.by_hbx_id (method)">by_hbx_id</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_match'>match</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
          <span class='id identifier rubyid_family'>family</span> <span class='op'>=</span> <span class='id identifier rubyid_find_family_by_subscriber'>find_family_by_subscriber</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_family'>family</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='period'>.</span><span class='id identifier rubyid_family'>family</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_matched_enrollments'>matched_enrollments</span> <span class='op'>=</span> <span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_active_household'>active_household</span><span class='period'>.</span><span class='id identifier rubyid_hbx_enrollments'>hbx_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span>
          <span class='symbol'>:kind</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span>
          <span class='symbol'>:aasm_state</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HbxEnrollment.html#ENROLLED_STATUSES-constant" title="HbxEnrollment::ENROLLED_STATUSES (constant)">ENROLLED_STATUSES</a></span></span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HbxEnrollment.html#TERMINATED_STATUSES-constant" title="HbxEnrollment::TERMINATED_STATUSES (constant)">TERMINATED_STATUSES</a></span></span><span class='rparen'>)</span><span class='comma'>,</span>
          <span class='symbol'>:coverage_kind</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_coverage_kind'>coverage_kind</span>
          <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order_by'>order_by</span><span class='lparen'>(</span><span class='symbol'>:effective_on</span><span class='period'>.</span><span class='id identifier rubyid_asc'>asc</span><span class='rparen'>)</span>
        <span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_active_year'>active_year</span> <span class='op'>==</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_active_year'>active_year</span><span class='rbrace'>}</span>
        <span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_en'>en</span><span class='op'>|</span> <span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span> <span class='op'>!=</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='rparen'>)</span><span class='rbrace'>}</span>

        <span class='id identifier rubyid_active_coverage'>active_coverage</span> <span class='op'>=</span> <span class='id identifier rubyid_matched_enrollments'>matched_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HbxEnrollment.html#ENROLLED_STATUSES-constant" title="HbxEnrollment::ENROLLED_STATUSES (constant)">ENROLLED_STATUSES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_aasm_state'>aasm_state</span><span class='rparen'>)</span><span class='rbrace'>}</span>
        
        <span class='kw'>if</span> <span class='id identifier rubyid_active_coverage'>active_coverage</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
          <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_to_csv'>to_csv</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>end</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_counter'>counter</span> <span class='op'>%</span> <span class='int'>100</span> <span class='op'>==</span> <span class='int'>0</span>
          <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Processed </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_counter'>counter</span><span class='embexpr_end'>}</span><span class='tstring_content'> Missing -- </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span> 
        <span class='comment'># csv &lt;&lt; (to_csv(enrollment) + [e.to_s])
</span>        <span class='comment'># puts &quot;#{e.to_s}&quot;
</span>      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="export_renewal_missing_enrollments-instance_method">
  
    #<strong>export_renewal_missing_enrollments</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/converge_data_export.rb', line 34</span>

<span class='kw'>def</span> <span class='id identifier rubyid_export_renewal_missing_enrollments'>export_renewal_missing_enrollments</span>
  <span class='id identifier rubyid_dentegra_id'>dentegra_id</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="CarrierProfile.html" title="CarrierProfile (class)">CarrierProfile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_all'><span class='object_link'><a href="CarrierProfile.html#all-class_method" title="CarrierProfile.all (method)">all</a></span></span><span class='period'>.</span><span class='id identifier rubyid_detect'>detect</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_legal_name'>legal_name</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Dentegra</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
  <span class='id identifier rubyid_dentegra_hios_ids'>dentegra_hios_ids</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Plan.html" title="Plan (class)">Plan</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>carrier_profile_id:</span> <span class='id identifier rubyid_dentegra_id'>dentegra_id</span><span class='comma'>,</span> <span class='label'>active_year:</span> <span class='int'>2016</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:hios_id</span><span class='rparen'>)</span>


  <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>enrollments_active_in_edi_but_not_renewed.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>w</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_csv'>csv</span><span class='op'>|</span>
    <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_headers'>headers</span>

    <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_glob'>glob</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="#XML_FOLDER_PATH-constant" title="ConvergeDataExport::XML_FOLDER_PATH (constant)">XML_FOLDER_PATH</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>/*.xml</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_file_path'>file_path</span><span class='op'>|</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_individual_parser'>individual_parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Parsers.html" title="Parsers (module)">Parsers</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml.html" title="Parsers::Xml (module)">Xml</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml/Cv.html" title="Parsers::Xml::Cv (module)">Cv</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml/Cv/Importers.html" title="Parsers::Xml::Cv::Importers (module)">Importers</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Parsers/Xml/Cv/Importers/EnrollmentParser.html" title="Parsers::Xml::Cv::Importers::EnrollmentParser (class)">EnrollmentParser</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Parsers/Xml/Cv/Importers/EnrollmentParser.html#initialize-instance_method" title="Parsers::Xml::Cv::Importers::EnrollmentParser#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='id identifier rubyid_file_path'>file_path</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_enrollment'>enrollment</span> <span class='op'>=</span> <span class='id identifier rubyid_individual_parser'>individual_parser</span><span class='period'>.</span><span class='id identifier rubyid_get_enrollment_object'>get_enrollment_object</span>

        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_dentegra_hios_ids'>dentegra_hios_ids</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_hios_id'>hios_id</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_canceled'>canceled</span> <span class='op'>=</span> <span class='kw'>false</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_coverage_end_on'>coverage_end_on</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_coverage_start_on'>coverage_start_on</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_coverage_end_on'>coverage_end_on</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_canceled'>canceled</span> <span class='op'>=</span> <span class='kw'>true</span> 
        <span class='kw'>end</span>

        <span class='kw'>next</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_canceled'>canceled</span> <span class='op'>||</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_terminated_on'>terminated_on</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_counter'>counter</span> <span class='op'>+=</span> <span class='int'>1</span>

        <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='period'>.</span><span class='id identifier rubyid_by_hbx_id'><span class='object_link'><a href="HbxEnrollment.html#by_hbx_id-class_method" title="HbxEnrollment.by_hbx_id (method)">by_hbx_id</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_match'>match</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
          <span class='id identifier rubyid_family'>family</span> <span class='op'>=</span> <span class='id identifier rubyid_find_family_by_subscriber'>find_family_by_subscriber</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_family'>family</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='period'>.</span><span class='id identifier rubyid_family'>family</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_renewals'>renewals</span> <span class='op'>=</span> <span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_active_household'>active_household</span><span class='period'>.</span><span class='id identifier rubyid_hbx_enrollments'>hbx_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span>
          <span class='symbol'>:kind</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span>
          <span class='symbol'>:aasm_state</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HbxEnrollment.html#RENEWAL_STATUSES-constant" title="HbxEnrollment::RENEWAL_STATUSES (constant)">RENEWAL_STATUSES</a></span></span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="HbxEnrollment.html#ENROLLED_STATUSES-constant" title="HbxEnrollment::ENROLLED_STATUSES (constant)">ENROLLED_STATUSES</a></span></span><span class='rparen'>)</span><span class='comma'>,</span>
          <span class='symbol'>:coverage_kind</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_coverage_kind'>coverage_kind</span><span class='comma'>,</span>
          <span class='symbol'>:effective_on</span> <span class='op'>=&gt;</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>2017</span><span class='comma'>,</span><span class='int'>1</span><span class='comma'>,</span><span class='int'>1</span><span class='rparen'>)</span>
        <span class='rbrace'>}</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_en'>en</span><span class='op'>|</span> <span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span> <span class='op'>!=</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='rparen'>)</span><span class='rbrace'>}</span>

        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_renewals'>renewals</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
        <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_to_csv'>to_csv</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>

        <span class='id identifier rubyid_matched_count'>matched_count</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_counter'>counter</span> <span class='op'>%</span> <span class='int'>100</span> <span class='op'>==</span> <span class='int'>0</span>
          <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Processed </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_counter'>counter</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Matched </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_matched_count'>matched_count</span><span class='embexpr_end'>}</span><span class='tstring_content'> -- missing -- </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span> 
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="find_family_by_subscriber-instance_method">
  
    #<strong>find_family_by_subscriber</strong>(enrollment)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/converge_data_export.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_find_family_by_subscriber'>find_family_by_subscriber</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_matched_people'>matched_people</span> <span class='op'>=</span> <span class='id identifier rubyid_match_person_instance'>match_person_instance</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_primary_applicant'>primary_applicant</span><span class='period'>.</span><span class='id identifier rubyid_person'>person</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_matched_people'>matched_people</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>&gt;</span> <span class='int'>1</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ambiguous person match</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_matched_people'>matched_people</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Person Match not found</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_matched_people'>matched_people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_families'>families</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ambiguous family match</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_matched_people'>matched_people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_families'>families</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>families not found</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_matched_people'>matched_people</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_families'>families</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="headers-instance_method">
  
    #<strong>headers</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/converge_data_export.rb', line 8</span>

<span class='kw'>def</span> <span class='id identifier rubyid_headers'>headers</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Enrollment HBX ID</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Subscriber HBX ID</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>SSN</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Last Name</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>First Name</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HIOS_ID</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Plan Name</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Effective On</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Terminated On</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Oct 11 09:49:50 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.2.3).
</div>

    </div>
  </body>
</html>