<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Enrollments::IndividualMarket::OpenEnrollmentBegin
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Enrollments::IndividualMarket::OpenEnrollmentBegin";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (O)</a> &raquo;
    <span class='title'>Enrollments</span> &raquo; <span class='title'>IndividualMarket</span>
     &raquo; 
    <span class="title">OpenEnrollmentBegin</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Enrollments::IndividualMarket::OpenEnrollmentBegin
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Enrollments::IndividualMarket::OpenEnrollmentBegin</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/enrollments/individual_market/open_enrollment_begin.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#active_enrollment_from_family-instance_method" title="#active_enrollment_from_family (instance method)">#<strong>active_enrollment_from_family</strong>(enrollment)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#can_renew_enrollment%3F-instance_method" title="#can_renew_enrollment? (instance method)">#<strong>can_renew_enrollment?</strong>(enrollment, family, renewal_benefit_coverage_period)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>def eligible_to_get_assistance?(enrollment)   if @<a
href="enrollment.subscriber.hbx_id">assisted_individuals</a>   end end.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#families-instance_method" title="#families (instance method)">#<strong>families</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#has_catastrophic_plan%3F-instance_method" title="#has_catastrophic_plan? (instance method)">#<strong>has_catastrophic_plan?</strong>(enrollment)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>  &#x21d2; OpenEnrollmentBegin </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Active IVL hbx enrollments without a termination date in the current year
kind &#39;individual&#39; health || dental effective on &gt;= 1/1/2016
terminated_on.blank? || terminated_on &gt; 12/31/2016 hbx sponsored benefit
Unassisted, Assisted, CSR Assisted, Catastrophic Responsible party :$or
=&gt; [   :terminated_on.lte =&gt;
HbxProfile.current_hbx.benefit_sponsorship.current_benefit_coverage_period.end_on,
:terminated_on =&gt; nil ] TODO: Move aged off people from immedidate
coverage household to extended coverage household on the day new benefit
coverage period begin.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is_csr%3F-instance_method" title="#is_csr? (instance method)">#<strong>is_csr?</strong>(enrollment)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is_individual_assisted%3F-instance_method" title="#is_individual_assisted? (instance method)">#<strong>is_individual_assisted?</strong>(enrollment)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#log_message-instance_method" title="#log_message (instance method)">#<strong>log_message</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_aqhp_renewals-instance_method" title="#process_aqhp_renewals (instance method)">#<strong>process_aqhp_renewals</strong>(renewal_benefit_coverage_period)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_enrollment_renewal-instance_method" title="#process_enrollment_renewal (instance method)">#<strong>process_enrollment_renewal</strong>(enrollment, renewal_benefit_coverage_period)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_from_sheet-instance_method" title="#process_from_sheet (instance method)">#<strong>process_from_sheet</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_missing_enrollments-instance_method" title="#process_missing_enrollments (instance method)">#<strong>process_missing_enrollments</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_renewals-instance_method" title="#process_renewals (instance method)">#<strong>process_renewals</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_uqhp_renewals-instance_method" title="#process_uqhp_renewals (instance method)">#<strong>process_uqhp_renewals</strong>(renewal_benefit_coverage_period)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#query_criteria-instance_method" title="#query_criteria (instance method)">#<strong>query_criteria</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="Enrollments::IndividualMarket::OpenEnrollmentBegin (class)">OpenEnrollmentBegin</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Active IVL hbx enrollments without a termination date in the current year
kind &#39;individual&#39; health || dental effective on &gt;= 1/1/2016
terminated_on.blank? || terminated_on &gt; 12/31/2016 hbx sponsored benefit
Unassisted, Assisted, CSR Assisted, Catastrophic Responsible party :$or
=&gt; [</p>

<pre class="code ruby"><code class="ruby">:terminated_on.lte =&gt; HbxProfile.current_hbx.benefit_sponsorship.current_benefit_coverage_period.end_on,
:terminated_on =&gt; nil</code></pre>

<p>] TODO: Move aged off people from immedidate coverage household to extended
coverage household on the day new benefit coverage period begin.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 18</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@logger</span> <span class='op'>=</span> <span class='const'>Logger</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='embexpr_end'>}</span><span class='tstring_content'>/log/ivl_open_enrollment_begin_</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="../../TimeKeeper.html" title="TimeKeeper (class)">TimeKeeper</a></span></span><span class='period'>.</span><span class='id identifier rubyid_date_of_record'><span class='object_link'><a href="../../TimeKeeper.html#date_of_record-class_method" title="TimeKeeper.date_of_record (method)">date_of_record</a></span></span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%Y_%m_%d</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>.log</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="active_enrollment_from_family-instance_method">
  
    #<strong>active_enrollment_from_family</strong>(enrollment)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192
193
194
195
196
197</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 191</span>

<span class='kw'>def</span> <span class='id identifier rubyid_active_enrollment_from_family'>active_enrollment_from_family</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_active_household'>active_household</span><span class='period'>.</span><span class='id identifier rubyid_hbx_enrollments'>hbx_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='symbol'>:kind</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>individual</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='symbol'>:aasm_state</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html#ENROLLED_STATUSES-constant" title="HbxEnrollment::ENROLLED_STATUSES (constant)">ENROLLED_STATUSES</a></span></span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>auto_renewing</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage_renewed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage_termination_pending</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='symbol'>:coverage_kind</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_coverage_kind'>coverage_kind</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="can_renew_enrollment?-instance_method">
  
    #<strong>can_renew_enrollment?</strong>(enrollment, family, renewal_benefit_coverage_period)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>def eligible_to_get_assistance?(enrollment)</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>if</span> <span class='ivar'>@assisted_individuals</span><span class='lbracket'>[</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</code></pre>

<p>end</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81
82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 74</span>

<span class='kw'>def</span> <span class='id identifier rubyid_can_renew_enrollment?'>can_renew_enrollment?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='comma'>,</span> <span class='id identifier rubyid_family'>family</span><span class='comma'>,</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_enrollments'>enrollments</span> <span class='op'>=</span> <span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_active_household'>active_household</span><span class='period'>.</span><span class='id identifier rubyid_hbx_enrollments'>hbx_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='symbol'>:coverage_kind</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_coverage_kind'>coverage_kind</span><span class='comma'>,</span>
    <span class='symbol'>:aasm_state</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html#ENROLLED_STATUSES-constant" title="HbxEnrollment::ENROLLED_STATUSES (constant)">ENROLLED_STATUSES</a></span></span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>auto_renewing</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>renewing_coverage_selected</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='symbol'>:effective_on</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_start_on'>start_on</span><span class='comma'>,</span>
    <span class='symbol'>:kind</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_kind'>kind</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_enrollments'>enrollments</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
  <span class='id identifier rubyid_enrollments'>enrollments</span><span class='period'>.</span><span class='id identifier rubyid_none?'>none?</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span> <span class='op'>==</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="families-instance_method">
  
    #<strong>families</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 53</span>

<span class='kw'>def</span> <span class='id identifier rubyid_families'>families</span>
  <span class='const'><span class='object_link'><a href="../../Family.html" title="Family (class)">Family</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:households.hbx_enrollments</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:$elemMatch</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_query_criteria'>query_criteria</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="has_catastrophic_plan?-instance_method">
  
    #<strong>has_catastrophic_plan?</strong>(enrollment)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


249
250
251</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 249</span>

<span class='kw'>def</span> <span class='id identifier rubyid_has_catastrophic_plan?'>has_catastrophic_plan?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_metal_level'>metal_level</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>catastrophic</span><span class='tstring_end'>&#39;</span></span>       
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="is_csr?-instance_method">
  
    #<strong>is_csr?</strong>(enrollment)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 64</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is_csr?'>is_csr?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_csr_plan_variants'>csr_plan_variants</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../EligibilityDetermination.html" title="EligibilityDetermination (class)">EligibilityDetermination</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../EligibilityDetermination.html#CSR_KIND_TO_PLAN_VARIANT_MAP-constant" title="EligibilityDetermination::CSR_KIND_TO_PLAN_VARIANT_MAP (constant)">CSR_KIND_TO_PLAN_VARIANT_MAP</a></span></span><span class='period'>.</span><span class='id identifier rubyid_except'>except</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>csr_100</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_metal_level'>metal_level</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>silver</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_csr_plan_variants'>csr_plan_variants</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_csr_variant_id'>csr_variant_id</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="is_individual_assisted?-instance_method">
  
    #<strong>is_individual_assisted?</strong>(enrollment)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


57
58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 57</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is_individual_assisted?'>is_individual_assisted?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span>      
  <span class='comment'># reader.all_assisted_individuals.keys
</span>  <span class='comment'># enrollment.applied_aptc_amount &gt; 0 || enrollment.elected_premium_credit &gt; 0 || enrollment.applied_premium_credit &gt; 0 || is_csr?(enrollment)
</span>  
  <span class='ivar'>@all_assisted_individuals</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="log_message-instance_method">
  
    #<strong>log_message</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


40
41
42</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 40</span>

<span class='kw'>def</span> <span class='id identifier rubyid_log_message'>log_message</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='kw'>yield</span> <span class='kw'>unless</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='period'>.</span><span class='id identifier rubyid_test?'>test?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_aqhp_renewals-instance_method">
  
    #<strong>process_aqhp_renewals</strong>(renewal_benefit_coverage_period)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 86</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_aqhp_renewals'>process_aqhp_renewals</span><span class='lparen'>(</span><span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../HbxProfile.html" title="HbxProfile (class)">HbxProfile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_current_hbx'><span class='object_link'><a href="../../HbxProfile.html#current_hbx-class_method" title="HbxProfile.current_hbx (method)">current_hbx</a></span></span><span class='period'>.</span><span class='id identifier rubyid_benefit_sponsorship'>benefit_sponsorship</span><span class='period'>.</span><span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:kind</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>individual</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='symbol'>:aasm_state</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html#ENROLLED_STATUSES-constant" title="HbxEnrollment::ENROLLED_STATUSES (constant)">ENROLLED_STATUSES</a></span></span> <span class='op'>-</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage_renewed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage_termination_pending</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='symbol'>:coverage_kind</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>health</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='symbol'>:effective_on</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$gte</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_start_on'>start_on</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$lt</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_end_on'>end_on</span><span class='rbrace'>}</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_count'>count</span>  <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@assisted_individuals</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='comma'>,</span> <span class='id identifier rubyid_aptc_values'>aptc_values</span><span class='op'>|</span>
    <span class='id identifier rubyid_person'>person</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Person.html" title="Person (class)">Person</a></span></span><span class='period'>.</span><span class='id identifier rubyid_by_hbx_id'>by_hbx_id</span><span class='lparen'>(</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_family'>family</span> <span class='op'>=</span> <span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_primary_family'>primary_family</span>

    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_active_household'>active_household</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>

    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Processing </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_full_name'>full_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='period'>.</span><span class='id identifier rubyid_test?'>test?</span>

    <span class='id identifier rubyid_enrollments'>enrollments</span> <span class='op'>=</span> <span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_active_household'>active_household</span><span class='period'>.</span><span class='id identifier rubyid_hbx_enrollments'>hbx_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:effective_on</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_desc'>desc</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_enrollments'>enrollments</span> <span class='op'>=</span> <span class='id identifier rubyid_enrollments'>enrollments</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span> <span class='op'>==</span> <span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='rparen'>)</span><span class='rbrace'>}</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_enrollments'>enrollments</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Found multiple active health enrollments for Person: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_enrollments'>enrollments</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_can_renew_enrollment?'>can_renew_enrollment?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollments'>enrollments</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_family'>family</span><span class='comma'>,</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>    
        <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span> <span class='op'>=</span> <span class='const'>Enrollments</span><span class='op'>::</span><span class='const'>IndividualMarket</span><span class='op'>::</span><span class='const'>FamilyEnrollmentRenewal</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
        <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_enrollment'>enrollment</span> <span class='op'>=</span> <span class='id identifier rubyid_enrollments'>enrollments</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_assisted'>assisted</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_aptc_values'>aptc_values</span> <span class='op'>=</span> <span class='id identifier rubyid_aptc_values'>aptc_values</span>
        <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_renewal_coverage_start'>renewal_coverage_start</span> <span class='op'>=</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_start_on'>start_on</span>

        <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_renew'>renew</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to find valid assisted enrollment for Person: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_count'>count</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_enrollment_renewal-instance_method">
  
    #<strong>process_enrollment_renewal</strong>(enrollment, renewal_benefit_coverage_period)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


182
183
184
185
186
187
188
189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 182</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_enrollment_renewal'>process_enrollment_renewal</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='comma'>,</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span><span class='embexpr_end'>}</span><span class='tstring_content'>--</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_kind'>kind</span><span class='embexpr_end'>}</span><span class='tstring_content'>--</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_aasm_state'>aasm_state</span><span class='embexpr_end'>}</span><span class='tstring_content'>--</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_coverage_kind'>coverage_kind</span><span class='embexpr_end'>}</span><span class='tstring_content'>--</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_effective_on'>effective_on</span><span class='embexpr_end'>}</span><span class='tstring_content'>--</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_plan'>plan</span><span class='period'>.</span><span class='id identifier rubyid_renewal_plan'>renewal_plan</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:active_year</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span> <span class='op'>=</span> <span class='const'>Enrollments</span><span class='op'>::</span><span class='const'>IndividualMarket</span><span class='op'>::</span><span class='const'>FamilyEnrollmentRenewal</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_enrollment'>enrollment</span> <span class='op'>=</span> <span class='id identifier rubyid_enrollment'>enrollment</span>
  <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_renewal_coverage_start'>renewal_coverage_start</span> <span class='op'>=</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_start_on'>start_on</span>
  <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_renew'>renew</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_from_sheet-instance_method">
  
    #<strong>process_from_sheet</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 253</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_from_sheet'>process_from_sheet</span>
  <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='embexpr_end'>}</span><span class='tstring_content'>/IVL_Enrollment_Renewals.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>w</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_csv'>csv</span><span class='op'>|</span>

    <span class='comment'># csv &lt;&lt; [&quot;Enrollment HBX ID&quot;, &quot;Subscriber HBX ID&quot;, &quot;SSN&quot;, &quot;Last Name&quot;, &quot;First Name&quot;, &quot;HIOS_ID:PlanName&quot;, &quot;Other Effective On&quot;,  
</span>    <span class='comment'>#   &quot;Effective On&quot;,  &quot;AASM State&quot;,  &quot;Terminated On Action&quot;,  &quot;Section:Attribute&quot;]
</span>
    <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enrollment HBX ID</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Subscriber HBXID</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Subscriber Firstname</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Subscriber Lastname</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Market</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Coverage Kind</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Coverage Start Date</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Created At</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Updated At</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Plan Name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Plan HIOS ID</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enrollment Status</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../HbxProfile.html" title="HbxProfile (class)">HbxProfile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_current_hbx'><span class='object_link'><a href="../../HbxProfile.html#current_hbx-class_method" title="HbxProfile.current_hbx (method)">current_hbx</a></span></span><span class='period'>.</span><span class='id identifier rubyid_benefit_sponsorship'>benefit_sponsorship</span><span class='period'>.</span><span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span>

    <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_foreach'>foreach</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='embexpr_end'>}</span><span class='tstring_content'>/individuals_missing_passive_renewals.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>headers:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:encoding</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
      <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>%</span> <span class='int'>100</span> <span class='op'>==</span> <span class='int'>0</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Found </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_content'> enrollments</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_hbx_enrollment'>hbx_enrollment</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='period'>.</span><span class='id identifier rubyid_by_hbx_id'><span class='object_link'><a href="../../HbxEnrollment.html#by_hbx_id-class_method" title="HbxEnrollment.by_hbx_id (method)">by_hbx_id</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_to_hash'>to_hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enrollment HBXID</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

      <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_hbx_enrollment'>hbx_enrollment</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
        <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>
        <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Failed: Unable to find matching enrollment.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>elsif</span> <span class='op'>!</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html#ENROLLED_STATUSES-constant" title="HbxEnrollment::ENROLLED_STATUSES (constant)">ENROLLED_STATUSES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_hbx_enrollment'>hbx_enrollment</span><span class='period'>.</span><span class='id identifier rubyid_aasm_state'>aasm_state</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>
        <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Failed: Enrollment in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_hbx_enrollment'>hbx_enrollment</span><span class='period'>.</span><span class='id identifier rubyid_aasm_state'>aasm_state</span><span class='embexpr_end'>}</span><span class='tstring_content'> state.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_has_catastrophic_plan?'>has_catastrophic_plan?</span><span class='lparen'>(</span><span class='id identifier rubyid_hbx_enrollment'>hbx_enrollment</span><span class='rparen'>)</span>
        <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Failed: Catastrophic plan found.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_is_individual_assisted?'>is_individual_assisted?</span><span class='lparen'>(</span><span class='id identifier rubyid_hbx_enrollment'>hbx_enrollment</span><span class='rparen'>)</span>
        <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Failed: Assisted Enrollment.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_process_enrollment_renewal'>process_enrollment_renewal</span><span class='lparen'>(</span><span class='id identifier rubyid_hbx_enrollment'>hbx_enrollment</span><span class='comma'>,</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='rparen'>)</span>
          <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Successful.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
          <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_tos'>tos</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span> <span class='op'>+</span> <span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_count'>count</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_missing_enrollments-instance_method">
  
    #<strong>process_missing_enrollments</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 199</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_missing_enrollments'>process_missing_enrollments</span>
  <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='embexpr_end'>}</span><span class='tstring_content'>/IVL_Enrollment_Renewals.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>w</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_csv'>csv</span><span class='op'>|</span>

    <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enrollment HBX ID</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Subscriber HBX ID</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SSN</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Last Name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>First Name</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HIOS_ID:PlanName</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Other Effective On</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Effective On</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AASM State</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Terminated On Action</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Section:Attribute</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Result</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../HbxProfile.html" title="HbxProfile (class)">HbxProfile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_current_hbx'><span class='object_link'><a href="../../HbxProfile.html#current_hbx-class_method" title="HbxProfile.current_hbx (method)">current_hbx</a></span></span><span class='period'>.</span><span class='id identifier rubyid_benefit_sponsorship'>benefit_sponsorship</span><span class='period'>.</span><span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span>
    <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../HbxProfile.html" title="HbxProfile (class)">HbxProfile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_current_hbx'><span class='object_link'><a href="../../HbxProfile.html#current_hbx-class_method" title="HbxProfile.current_hbx (method)">current_hbx</a></span></span><span class='period'>.</span><span class='id identifier rubyid_benefit_sponsorship'>benefit_sponsorship</span><span class='period'>.</span><span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span>

    <span class='const'>CSV</span><span class='period'>.</span><span class='id identifier rubyid_foreach'>foreach</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_root'>root</span><span class='embexpr_end'>}</span><span class='tstring_content'>/individual_enrollment_change_sets_12_05_2016_10_35.csv</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>headers:</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:encoding</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
      <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>%</span> <span class='int'>100</span> <span class='op'>==</span> <span class='int'>0</span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Found </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_content'> enrollments</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_enrollment'>enrollment</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='period'>.</span><span class='id identifier rubyid_by_hbx_id'><span class='object_link'><a href="../../HbxEnrollment.html#by_hbx_id-class_method" title="HbxEnrollment.by_hbx_id (method)">by_hbx_id</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_to_hash'>to_hash</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Enrollment HBX ID</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

      <span class='id identifier rubyid_hbx_enrollments'>hbx_enrollments</span> <span class='op'>=</span> <span class='id identifier rubyid_active_enrollment_from_family'>active_enrollment_from_family</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_en'>en</span><span class='op'>|</span> <span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span> <span class='op'>!=</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_subscriber'>subscriber</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span> <span class='rbrace'>}</span>

      <span class='id identifier rubyid_current_coverages'>current_coverages</span> <span class='op'>=</span> <span class='id identifier rubyid_hbx_enrollments'>hbx_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_en'>en</span><span class='op'>|</span> <span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_contains?'>contains?</span><span class='lparen'>(</span><span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_effective_on'>effective_on</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_renewal_coverages'>renewal_coverages</span> <span class='op'>=</span> <span class='id identifier rubyid_hbx_enrollments'>hbx_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_en'>en</span><span class='op'>|</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_contains?'>contains?</span><span class='lparen'>(</span><span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_effective_on'>effective_on</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

      <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_coverages'>current_coverages</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
        <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Failed: Unable to find matching enrollment.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> 
      <span class='kw'>elsif</span> <span class='id identifier rubyid_current_coverages'>current_coverages</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
        <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Failed: found multiple active enrollments.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> 
      <span class='kw'>elsif</span> <span class='id identifier rubyid_renewal_coverages'>renewal_coverages</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
        <span class='id identifier rubyid_en'>en</span> <span class='op'>=</span> <span class='id identifier rubyid_renewal_coverages'>renewal_coverages</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Failed: Already got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_effective_on'>effective_on</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span><span class='embexpr_end'>}</span><span class='tstring_content'> coverage with </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_aasm_state'>aasm_state</span><span class='period'>.</span><span class='id identifier rubyid_camelcase'>camelcase</span><span class='embexpr_end'>}</span><span class='tstring_content'> status.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_is_individual_assisted?'>is_individual_assisted?</span><span class='lparen'>(</span><span class='id identifier rubyid_current_coverages'>current_coverages</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span>
        <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Failed: Assisted Enrollment.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_process_enrollment_renewal'>process_enrollment_renewal</span><span class='lparen'>(</span><span class='id identifier rubyid_current_coverages'>current_coverages</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='rparen'>)</span>
          <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Successful.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
          <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Renewal Failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_tos'>tos</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_csv'>csv</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_row'>row</span><span class='period'>.</span><span class='id identifier rubyid_to_h'>to_h</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span> <span class='op'>+</span> <span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_count'>count</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_renewals-instance_method">
  
    #<strong>process_renewals</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 22</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_renewals'>process_renewals</span>
  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Started process at </span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_in_time_zone'>in_time_zone</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eastern Time (US &amp; Canada)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%m-%d-%Y %H:%M</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../HbxProfile.html" title="HbxProfile (class)">HbxProfile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_current_hbx'><span class='object_link'><a href="../../HbxProfile.html#current_hbx-class_method" title="HbxProfile.current_hbx (method)">current_hbx</a></span></span><span class='period'>.</span><span class='id identifier rubyid_benefit_sponsorship'>benefit_sponsorship</span><span class='period'>.</span><span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span>

  <span class='id identifier rubyid_aptc_reader'>aptc_reader</span> <span class='op'>=</span> <span class='const'>Enrollments</span><span class='op'>::</span><span class='const'>IndividualMarket</span><span class='op'>::</span><span class='const'>AssistedIvlAptcReader</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_aptc_reader'>aptc_reader</span><span class='period'>.</span><span class='id identifier rubyid_calender_year'>calender_year</span> <span class='op'>=</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_start_on'>start_on</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span>
  <span class='id identifier rubyid_aptc_reader'>aptc_reader</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span>

  <span class='ivar'>@assisted_individuals</span> <span class='op'>=</span> <span class='id identifier rubyid_aptc_reader'>aptc_reader</span><span class='period'>.</span><span class='id identifier rubyid_assisted_individuals'>assisted_individuals</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Found </span><span class='embexpr_beg'>#{</span><span class='ivar'>@assisted_individuals</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_content'> entries in Assisted sheet.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_env'>env</span><span class='period'>.</span><span class='id identifier rubyid_test?'>test?</span>

  <span class='id identifier rubyid_process_aqhp_renewals'>process_aqhp_renewals</span><span class='lparen'>(</span><span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_process_uqhp_renewals'>process_uqhp_renewals</span><span class='lparen'>(</span><span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='rparen'>)</span>

  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Process ended at </span><span class='embexpr_beg'>#{</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_in_time_zone'>in_time_zone</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Eastern Time (US &amp; Canada)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%m-%d-%Y %H:%M</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process_uqhp_renewals-instance_method">
  
    #<strong>process_uqhp_renewals</strong>(renewal_benefit_coverage_period)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 133</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process_uqhp_renewals'>process_uqhp_renewals</span><span class='lparen'>(</span><span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../HbxProfile.html" title="HbxProfile (class)">HbxProfile</a></span></span><span class='period'>.</span><span class='id identifier rubyid_current_hbx'><span class='object_link'><a href="../../HbxProfile.html#current_hbx-class_method" title="HbxProfile.current_hbx (method)">current_hbx</a></span></span><span class='period'>.</span><span class='id identifier rubyid_benefit_sponsorship'>benefit_sponsorship</span><span class='period'>.</span><span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span>

  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:kind</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>individual</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='symbol'>:aasm_state</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html#ENROLLED_STATUSES-constant" title="HbxEnrollment::ENROLLED_STATUSES (constant)">ENROLLED_STATUSES</a></span></span> <span class='op'>-</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage_renewed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage_termination_pending</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='symbol'>:coverage_kind</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="../../HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html#COVERAGE_KINDS-constant" title="HbxEnrollment::COVERAGE_KINDS (constant)">COVERAGE_KINDS</a></span></span><span class='comma'>,</span>
    <span class='symbol'>:effective_on</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$gte</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_start_on'>start_on</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$lt</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_end_on'>end_on</span><span class='rbrace'>}</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_families'>families</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Family.html" title="Family (class)">Family</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:households.hbx_enrollments</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:$elemMatch</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_query'>query</span><span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Families count </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_families'>families</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span> <span class='op'>=</span> <span class='const'>Enrollments</span><span class='op'>::</span><span class='const'>IndividualMarket</span><span class='op'>::</span><span class='const'>FamilyEnrollmentRenewal</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_renewal_coverage_start'>renewal_coverage_start</span> <span class='op'>=</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_start_on'>start_on</span>
  <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_assisted'>assisted</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_aptc_values'>aptc_values</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='id identifier rubyid_count'>count</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_families'>families</span><span class='period'>.</span><span class='id identifier rubyid_no_timeout'>no_timeout</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_family'>family</span><span class='op'>|</span>
    <span class='id identifier rubyid_primary_hbx_id'>primary_hbx_id</span> <span class='op'>=</span> <span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_primary_applicant'>primary_applicant</span><span class='period'>.</span><span class='id identifier rubyid_person'>person</span><span class='period'>.</span><span class='id identifier rubyid_hbx_id'>hbx_id</span>

    <span class='kw'>begin</span>
      <span class='id identifier rubyid_enrollments'>enrollments</span> <span class='op'>=</span> <span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_active_household'>active_household</span><span class='period'>.</span><span class='id identifier rubyid_hbx_enrollments'>hbx_enrollments</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:effective_on</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_desc'>desc</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_enrollments'>enrollments</span> <span class='op'>=</span> <span class='id identifier rubyid_enrollments'>enrollments</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_en'>en</span><span class='op'>|</span> <span class='id identifier rubyid_current_benefit_coverage_period'>current_benefit_coverage_period</span><span class='period'>.</span><span class='id identifier rubyid_contains?'>contains?</span><span class='lparen'>(</span><span class='id identifier rubyid_en'>en</span><span class='period'>.</span><span class='id identifier rubyid_effective_on'>effective_on</span><span class='rparen'>)</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_enrollments'>enrollments</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='op'>|</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='ivar'>@assisted_individuals</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_primary_hbx_id'>primary_hbx_id</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_enrollment'>enrollment</span><span class='period'>.</span><span class='id identifier rubyid_coverage_kind'>coverage_kind</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>health</span><span class='tstring_end'>&#39;</span></span>

        <span class='kw'>if</span> <span class='id identifier rubyid_can_renew_enrollment?'>can_renew_enrollment?</span><span class='lparen'>(</span><span class='id identifier rubyid_enrollment'>enrollment</span><span class='comma'>,</span> <span class='id identifier rubyid_family'>family</span><span class='comma'>,</span> <span class='id identifier rubyid_renewal_benefit_coverage_period'>renewal_benefit_coverage_period</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_count'>count</span> <span class='op'>+=</span> <span class='int'>1</span>

          <span class='kw'>if</span> <span class='id identifier rubyid_count'>count</span> <span class='op'>%</span> <span class='int'>100</span> <span class='op'>==</span> <span class='int'>0</span>
            <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Found </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_count'>count</span><span class='embexpr_end'>}</span><span class='tstring_content'> enrollments</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>end</span>

          <span class='comment'># puts &quot;#{enrollment.hbx_id}--#{enrollment.kind}--#{enrollment.aasm_state}--#{enrollment.coverage_kind}--#{enrollment.effective_on}--#{enrollment.plan.renewal_plan.try(:active_year)}&quot;
</span>
          <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_enrollment'>enrollment</span> <span class='op'>=</span> <span class='id identifier rubyid_enrollment'>enrollment</span>
          <span class='id identifier rubyid_enrollment_renewal'>enrollment_renewal</span><span class='period'>.</span><span class='id identifier rubyid_renew'>renew</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span> 
      <span class='ivar'>@logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed ECaseId: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_family'>family</span><span class='period'>.</span><span class='id identifier rubyid_e_case_id'>e_case_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> Primary: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_primary_hbx_id'>primary_hbx_id</span><span class='embexpr_end'>}</span><span class='tstring_content'> Exception: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_count'>count</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="query_criteria-instance_method">
  
    #<strong>query_criteria</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46
47
48
49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/enrollments/individual_market/open_enrollment_begin.rb', line 44</span>

<span class='kw'>def</span> <span class='id identifier rubyid_query_criteria'>query_criteria</span>
  <span class='lbrace'>{</span>
    <span class='symbol'>:kind</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>individual</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='symbol'>:aasm_state</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span> <span class='op'>=&gt;</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html#ENROLLED_STATUSES-constant" title="HbxEnrollment::ENROLLED_STATUSES (constant)">ENROLLED_STATUSES</a></span></span> <span class='op'>-</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage_renewed</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coverage_termination_pending</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='symbol'>:coverage_kind</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span> <span class='op'>=&gt;</span> <span class='const'><span class='object_link'><a href="../../HbxEnrollment.html" title="HbxEnrollment (class)">HbxEnrollment</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../HbxEnrollment.html#COVERAGE_KINDS-constant" title="HbxEnrollment::COVERAGE_KINDS (constant)">COVERAGE_KINDS</a></span></span>
    <span class='comment'># :effective_on.gte =&gt; HbxProfile.current_hbx.benefit_sponsorship.current_benefit_coverage_period.start_on
</span>  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Oct 11 09:50:54 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.2.3).
</div>

    </div>
  </body>
</html>